# üîí Firebase Database Rules ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏£‡πà‡∏°

## üìã ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Rules

### üéØ ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
1. **‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô** - ‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡πà‡∏°‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á login
2. **‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö‡∏à‡∏≥‡∏Å‡∏±‡∏î** - ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ, Admin ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á
3. **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•** - validate format ‡πÅ‡∏•‡∏∞ logic
4. **‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô spam** - ‡∏à‡∏≥‡∏Å‡∏±‡∏î timestamp ‡πÅ‡∏•‡∏∞ rate limit

## üõ°Ô∏è Umbrellas Collection Rules

### ‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Read)
```json
".read": true
```
- ‚úÖ **‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡πà‡∏°‡πÅ‡∏ö‡∏ö real-time
- üéØ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

### ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Write)
```json
".write": "auth != null"
```
- ‚úÖ **Admin ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á** (‡∏°‡∏µ authentication)
- ‚ùå **‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ** ‡∏ï‡πâ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô rule ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡πà‡∏°

### ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πà‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏±‡∏ô
```json
".write": "auth != null || (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç)"
```

**‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:**
1. **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏£‡πà‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á** (1-21 ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
2. **‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á** (borrowed ‡∏´‡∏£‡∏∑‡∏≠ available)
3. **ID ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö path** ($umbrellaId)
4. **‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö** (id, status, currentLocation)

### ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Validation)
```json
".validate": "‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô"
```

**‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡πà‡∏°‡∏ß‡πà‡∏≤‡∏á (available):**
- ‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• borrower
- ‚úÖ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ = "available"
- ‚úÖ ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡πÉ‡∏ï‡πâ‡πÇ‡∏î‡∏°/‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏µ‡∏¨‡∏≤/‡πÇ‡∏£‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£)

**‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏° (borrowed):**
- ‚úÖ ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• borrower ‡∏Ñ‡∏£‡∏ö (nickname, phone, timestamp)
- ‚úÖ ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ 10 ‡∏´‡∏•‡∏±‡∏Å
- ‚úÖ ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á
- ‚úÖ timestamp ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0

## üìä Activities Collection Rules

### ‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Read)
```json
".read": true
```
- ‚úÖ **‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

### ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Write)
```json
".write": "auth != null || (‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)"
```

**‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:**
1. **‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô** (type, umbrellaId, location, timestamp)
2. **‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á** (borrow ‡∏´‡∏£‡∏∑‡∏≠ return ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
3. **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏£‡πà‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á** (1-21)
4. **‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á**
5. **Timestamp ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πà‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡∏ô‡∏≤‡∏ó‡∏µ** (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô replay attack)

**Admin ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ:**
- ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° activity ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó "admin_update"
- ‚úÖ ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏ß‡∏•‡∏≤

### ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Validation)
```json
".validate": "‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"
```
- ‚úÖ **Timestamp ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï** (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 1 ‡∏ô‡∏≤‡∏ó‡∏µ)
- ‚úÖ **‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏µ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å field**
- ‚úÖ **Format ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î**

## üöÄ ‡∏Å‡∏≤‡∏£ Deploy Rules

### 1. ‡∏ú‡πà‡∏≤‡∏ô Firebase Console
```bash
# ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Firebase Console > Database > Rules
# Copy-paste rule ‡∏à‡∏≤‡∏Å firebase-rules.json
# ‡∏Å‡∏î Publish
```

### 2. ‡∏ú‡πà‡∏≤‡∏ô Firebase CLI
```bash
# ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Firebase CLI
npm install -g firebase-tools

# Login
firebase login

# Deploy rules
firebase deploy --only database
# ‡∏´‡∏£‡∏∑‡∏≠
npm run deploy:rules
```

## üîç ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö Rules

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î Development
```javascript
// ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏Ñ‡∏ß‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à)
firebase.database().ref('umbrellas').once('value')

// ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà login (‡∏Ñ‡∏ß‡∏£‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß)
firebase.database().ref('umbrellas/1').set({invalid: true})

// ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏Ñ‡∏ß‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à)
firebase.database().ref('umbrellas/1').set({
  id: 1,
  status: 'borrowed',
  currentLocation: '‡πÉ‡∏ï‡πâ‡πÇ‡∏î‡∏°',
  borrower: {
    nickname: '‡∏ó‡∏î‡∏™‡∏≠‡∏ö',
    phone: '0123456789',
    timestamp: Date.now()
  }
})
```

## üìà ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢

### ‡∏Å‡∏≤‡∏£‡∏•‡∏î Bandwidth
- **‡∏à‡∏≥‡∏Å‡∏±‡∏î activities** ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 50 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
- **Cache ‡∏ó‡∏µ‡πà client** ‡∏•‡∏î request ‡∏ã‡πâ‡∏≥
- **Indexed queries** ‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î

### Security Benefits
- üîí **‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô SQL Injection** (NoSQL = ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)
- üîí **‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Data Manipulation** 
- üîí **Rate Limiting** ‡∏ú‡πà‡∏≤‡∏ô timestamp check
- üîí **Input Validation** ‡πÅ‡∏ö‡∏ö‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î

## ‚ö†Ô∏è ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á

### 1. ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Rules
```bash
# ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏° backup rules ‡πÄ‡∏Å‡πà‡∏≤
# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏ô development ‡∏Å‡πà‡∏≠‡∏ô
# Deploy ‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
```

### 2. ‡∏Å‡∏≤‡∏£ Monitor
```bash
# ‡∏î‡∏π Usage ‡πÉ‡∏ô Firebase Console
# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Error logs
# Monitor Performance
```

### 3. Emergency Access
```bash
# ‡∏™‡∏£‡πâ‡∏≤‡∏á admin user ‡∏™‡∏≥‡∏£‡∏≠‡∏á
# ‡πÄ‡∏Å‡πá‡∏ö service account key ‡πÑ‡∏ß‡πâ
# ‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏Ñ‡∏£‡πÄ‡∏õ‡πá‡∏ô super admin
```

---

## üéØ ‡∏™‡∏£‡∏∏‡∏õ: Rules ‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏£‡∏∞‡∏î‡∏±‡∏ö Production

‚úÖ **‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ** ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏¥‡∏î‡πÜ  
‚úÖ **Admin ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á** ‡∏ú‡πà‡∏≤‡∏ô authentication  
‚úÖ **‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å validate** ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô bad data  
‚úÖ **‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô spam** ‡∏î‡πâ‡∏ß‡∏¢ timestamp check  
‚úÖ **‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô** 800 ‡∏Ñ‡∏ô ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
